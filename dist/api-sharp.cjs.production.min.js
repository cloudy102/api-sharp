"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var t=e(require("tiny-invariant"));require("tiny-warning");var r=e(require("prop-types")),o=e(require("axios"));function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e}).apply(this,arguments)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e,t,r){return(c=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var o=[null];o.push.apply(o,t);var n=new(Function.bind.apply(e,o));return r&&s(n,r.prototype),n}).apply(null,arguments)}function i(e){var t="function"==typeof Map?new Map:void 0;return(i=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return c(e,arguments,a(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),s(r,e)})(e)}function u(e){return"string"==typeof e}function l(e){return"function"==typeof e}function h(e){return void 0===e}function p(e){return"number"==typeof e}function m(e){return e}function f(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var o=0,n=t;o<n.length;o++){var a=n[o];if(!h(a))return a}}function d(e){return Array.isArray(e)?"["+[].concat(e).sort().map(d)+"]":"object"==typeof e?Object.keys(e).sort().reduce(function(t,r,o,n){return(t+=r+":"+e[r])+(o!==n.length-1?",":"}")},"{"):String(e)}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var b=function(e,t){this.data=e,this.timeout=t,this.cacheTime=Date.now()},y=function(){function e(e){void 0===e&&(e=3e5),this.cacheMap=new Map,this.defaultCacheTime=e}var t=e.prototype;return t.isOverTime=function(e){var t=this.cacheMap.get(e);if(!t)return!0;var r=Date.now()-t.cacheTime;return r>0&&r>t.timeout&&(this.cacheMap.delete(e),!0)},t.has=function(e){return!this.isOverTime(e)},t.delete=function(e){return this.cacheMap.delete(e)},t.get=function(e){if(!this.isOverTime(e)){var t=this.cacheMap.get(e);if(t)return t.data}},t.set=function(e,t,r){var o=(void 0===r?{}:r).timeout,n=new b(t,void 0===o?this.defaultCacheTime:o);return this.cacheMap.set(e,n),t},t.clear=function(){return this.cacheMap.clear()},e}(),g=function(){function e(){}return e.prototype.request=function(e){try{return new Promise(function(t){var r,o=new XMLHttpRequest,n=e.baseURL+e.url+((r=function(e){return Object.keys(e).reduce(function(t,r){return(t?t+"&":t)+(encodeURIComponent(r)+"=")+encodeURIComponent(e[r])},"")}(e.query))?"?":"")+r;o.open(e.method,n,!0),Object.keys(e.headers).forEach(function(t){return o.setRequestHeader(t,e.headers[t])});var a,s=null;"POST"===e.method&&(null!==(a=e.body)&&"object"==typeof a&&a.__proto__===Object.prototype?(s=JSON.stringify(e.body),o.setRequestHeader("Content-Type","application/json")):s=e.body),o.responseType="text",o.send(s),o.onreadystatechange=function(){if(this.readyState===XMLHttpRequest.DONE){var e=function(e){var t=e.trim().split(/[\r\n]+/),r={};return t.forEach(function(e){var t=e.split(": "),o=t.shift(),n=t.join(": ");r[o]=n}),r}(this.getAllResponseHeaders()),r={data:this.response,status:this.status,statusText:this.statusText,headers:e};!this.response&&this.responseText&&(r.data=this.responseText);try{r.data=JSON.parse(r.data)}catch(e){}t(r)}}})}catch(e){return Promise.reject(e)}},e}(),R=function(){function e(){}return e.prototype.request=function(e){try{return Promise.resolve(o.request({baseURL:e.baseURL,url:e.url,method:e.method,params:"GET"===e.method?e.query:null,data:"POST"===e.method?e.body:null,headers:e.headers})).then(function(e){return{data:e.data,status:e.status,statusText:e.statusText,headers:e.headers}})}catch(e){return Promise.reject(e)}},e}(),T=function(e){var t,r;function o(t,r){var o;return(o=e.call(this,t)||this).api=r,o}return r=e,(t=o).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,o}(i(Error)),v={httpClient:new g,cache:new y,url:"",baseURL:"",headers:{},enableMock:!1,mockData:void 0,method:"GET",params:{},description:"",enableCache:!1,cacheTime:5e3,paramsTransformer:m,returnsTransformer:m,enableRetry:!1,retryTimes:1,timeout:6e4,enableLog:!1,logFormatter:{logRequest:function(e){console.log("%cRequest %c %c"+e.method+"|"+e.description+"|"+e.url+"%c|%O","color: white; background-color: rgba(0, 116, 217, 0.69); padding: 2px 5px; border-radius: 2px","","color: #0074D9","",e.params)},logResponse:function(e,t){console.log("%cResponse%c %c"+e.method+"|"+e.description+"|"+e.url+"%c|%O|%O","color: white; background-color: rgba(61, 153, 112, 0.69); padding: 2px 5px; border-radius: 2px","","color: #3D9970","",e.params,t)},logResponseError:function(e,t,r){console.log("%cResponse%c %c"+t.method+"|"+t.description+"|"+t.url+"%c|%O|%O","color: white; background-color: rgba(255, 65, 54, 0.69); padding: 2px 5px; border-radius: 2px","","color: #FF4136","",t.params,r)},logResponseCache:function(e,t){console.log("%cResponse Cache %c %c"+e.method+"|"+e.description+"|"+e.url+"%c|%O|%O","color: white; background-color: rgba(177, 13, 201, 0.69); padding: 2px 5px; border-radius: 2px","","color: #B10DC9","",e.params,t)}}},C=function(){function e(e){void 0===e&&(e={}),this.httpClient=f(e.httpClient,v.httpClient),this.cache=v.cache,this.baseURL=f(e.baseURL,v.baseURL),this.method=f(e.method,v.method),this.headers=f(e.headers,v.headers),this.paramsTransformer=f(e.paramsTransformer,v.paramsTransformer),this.returnsTransformer=f(e.returnsTransformer,v.returnsTransformer),this.enableCache=f(e.enableCache,v.enableCache),this.cacheTime=f(e.cacheTime,v.cacheTime),this.enableRetry=f(e.enableRetry,v.enableRetry),this.retryTimes=f(e.retryTimes,v.retryTimes),this.timeout=f(e.timeout,v.timeout),this.enableLog=f(e.enableLog,v.enableLog),this.logFormatter=f(e.logFormatter,v.logFormatter)}var o=e.prototype;return o.request=function(e){try{var t,r,o=!1,a=this,s=function(e){if(o)return e;var t=a.checkResponseData(i.data);if(!t.success){if(c.enableCache&&a.cache.delete(r),c.enableRetry&&c.retryTimes>=1)return a.request(n({},c,{retryTimes:c.retryTimes-1,__retry:!0}));throw a.logResponseError(new Error(t.errMsg),c,i.data),new T(t.errMsg,c)}return u?a.logResponseCache(c,i.data):a.logResponse(c,i.data),{data:c.returnsTransformer(i.data),from:u?"cache":"network",api:c,status:i.status,statusText:i.statusText,headers:i.headers}},c=a.processApi(e);if(a.logRequest(c),c.enableMock)return{data:c.mockData,from:"mock",api:c,headers:{},status:200,statusText:"OK(mock)"};var i,u=!1,l=new Promise(function(e,t){var r=new Error("请求超时("+c.timeout+"ms)");setTimeout(function(){return t(r)},c.timeout)});c.enableCache?(r=a.generateCachedKey(c),a.cache.has(r)?(t=a.cache.get(r),u=!0):(t=a.sendRequest(c),u=!1,a.cache.set(r,t,{timeout:c.cacheTime}))):t=a.sendRequest(c);var h=function(e,r){try{var o=Promise.resolve(Promise.race([t,l])).then(function(e){i=e})}catch(e){return r(e)}return o&&o.then?o.then(void 0,r):o}(0,function(e){if(c.enableCache&&a.cache.delete(r),c.enableRetry&&c.retryTimes>=1)return o=!0,a.request(n({},c,{retryTimes:c.retryTimes-1,__retry:!0}));throw a.logResponseError(e,c),new T(e.message,c)});return h&&h.then?h.then(s):s(h)}catch(e){return Promise.reject(e)}},o.clearCache=function(){return this.cache.clear()},o.sendRequest=function(e){return this.httpClient.request({baseURL:e.baseURL,url:e.url,method:e.method,headers:e.headers,query:"GET"===e.method?e.params:{},body:"POST"===e.method?e.params:{}})},o.generateCachedKey=function(e){return e.method+" "+e.baseURL+e.url+"?"+d(e.params)},o.processApi=function(e){e||t(!1),u(e)&&(e={url:e});var o,a=n({},e);e.url&&String(e.url)?a.url=String(e.url):t(!1),a.baseURL=h(e.baseURL)?this.baseURL:e.baseURL,a.baseURL=a.baseURL.replace(/\/+$/,""),h(e.method)?a.method=this.method:u(e.method)&&/get|post/i.test(e.method)?a.method=e.method.toUpperCase():t(!1),a.headers=h(e.headers)?this.headers:e.headers,a.description=h(e.description)?v.description:l(e.description)?String(e.description.call(null,e)):String(e.description),a.enableCache=h(e.enableCache)?this.enableCache:l(e.enableCache)?!!e.enableCache.call(null,e):!!e.enableCache,"GET"!==a.method.toUpperCase()&&a.enableCache&&(a.enableCache=!1),a.cacheTime=h(e.cacheTime)?this.cacheTime:p(e.cacheTime)?e.cacheTime:l(e.cacheTime)?e.cacheTime.call(null,e):this.cacheTime,a.enableMock=h(e.enableMock)?v.enableMock:l(e.enableMock)?!!e.enableMock.call(null,e):!!e.enableMock,a.mockData=h(e.mockData)?v.mockData:l(e.mockData)?e.mockData.call(null,e):e.mockData,a.enableRetry=h(e.enableRetry)?this.enableRetry:l(e.enableRetry)?!!e.enableRetry.call(null,e):!!e.enableRetry,a.retryTimes=h(e.retryTimes)?this.retryTimes:p(e.retryTimes)?e.retryTimes:l(e.retryTimes)?e.retryTimes.call(null,e):this.retryTimes,a.timeout=h(e.timeout)?this.timeout:e.timeout,a.enableLog=h(e.enableLog)?this.enableLog:l(e.enableLog)?!!e.enableLog.call(null,e):!!e.enableLog,a.logFormatter=h(e.logFormatter)?this.logFormatter:null!==(o=e.logFormatter)&&"object"==typeof o?{logRequest:e.logFormatter.logRequest||this.logFormatter.logRequest,logResponse:e.logFormatter.logResponse||this.logFormatter.logResponse,logResponseError:e.logFormatter.logResponseError||this.logFormatter.logResponseError,logResponseCache:e.logFormatter.logResponseCache||this.logFormatter.logResponseCache}:this.logFormatter;var s=h(e.params)?v.params:e.params;return s=(h(e.paramsTransformer)?this.paramsTransformer:l(e.paramsTransformer)?e.paramsTransformer:this.paramsTransformer).call(null,s),h(e.paramsType)||r.checkPropTypes(e.paramsType,s,"",a.baseURL+a.url),a.params=s,h(e.returnsTransformer)&&(a.returnsTransformer=this.returnsTransformer),a},o.checkResponseData=function(e){return{success:!!e}},o.logRequest=function(e){e.enableLog&&e.logFormatter.logRequest(e)},o.logResponse=function(e,t){e.enableLog&&e.logFormatter.logResponse(e,t)},o.logResponseError=function(e,t,r){t.enableLog&&t.logFormatter.logResponseError(e,t,r)},o.logResponseCache=function(e,t){e.enableLog&&e.logFormatter.logResponseCache(e,t)},e}();exports.WebAxiosClient=R,exports.WebXhrClient=g,exports.default=C;
//# sourceMappingURL=api-sharp.cjs.production.min.js.map
